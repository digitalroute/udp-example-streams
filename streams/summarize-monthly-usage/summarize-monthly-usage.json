{
  "schemaVersion": 1,
  "name": "Summarize Monthly Usage",
  "nodes": [
    {
      "partitionKey": null,
      "schemaVersion": 1,
      "id": "df2d3300-4cbe-11ea-9014-2b24e4165af9",
      "name": "Count",
      "type": "readers/counter",
      "params": {
        "max": 5
      },
      "x": 450,
      "y": 200
    },
    {
      "partitionKey": null,
      "schemaVersion": 1,
      "id": "ec556ca0-4cbe-11ea-9014-2b24e4165af9",
      "name": "Simulate Data",
      "type": "transforms/script",
      "params": {
        "transform": "/*\nA sample script that\n- simulate simple usage data\n- sample usage of moment npm library\n*/\n\nlog.info (\"Receive input: \" + JSON.stringify(payload));\n\n// create sample usage event\nvar usageEvent = {\n    eventId: payload.value,\n    userId: \"USER-1001\",\n    usage: 2 * payload.value,\n    dateTime: simDate(),\n}\n\n// send the usage event to next function\nawait push(usageEvent)\n\n// simulate different of date for each event\nfunction simDate() {\n    var moment = require(\"moment\");\n    var date = moment().add('days', payload.value);\n    return date.format('YYYY-MM-DD');\n}"
      },
      "x": 650,
      "y": 200
    },
    {
      "partitionKey": null,
      "schemaVersion": 1,
      "id": "136fe100-4ccc-11ea-9014-2b24e4165af9",
      "name": "Aggregate",
      "type": "transforms/aggregate",
      "params": {
        "key": "${userId}",
        "valueKey": "${usage}",
        "dateKey": "${dateTime}",
        "window": "month"
      },
      "x": 850,
      "y": 200
    },
    {
      "partitionKey": null,
      "schemaVersion": 1,
      "id": "84b4dea0-51c3-11ea-bec0-a7e1071491c2",
      "name": "Log",
      "type": "writers/log",
      "params": {},
      "x": 1050,
      "y": 200
    }
  ],
  "edges": [
    {
      "id": "afc74fb0-4cc3-11ea-9014-2b24e4165af9",
      "from": "df2d3300-4cbe-11ea-9014-2b24e4165af9",
      "to": "ec556ca0-4cbe-11ea-9014-2b24e4165af9",
      "config": {}
    },
    {
      "id": "1b293760-51c3-11ea-bec0-a7e1071491c2",
      "from": "ec556ca0-4cbe-11ea-9014-2b24e4165af9",
      "to": "136fe100-4ccc-11ea-9014-2b24e4165af9",
      "config": {}
    },
    {
      "id": "85ebb0f0-51c3-11ea-bec0-a7e1071491c2",
      "from": "136fe100-4ccc-11ea-9014-2b24e4165af9",
      "to": "84b4dea0-51c3-11ea-bec0-a7e1071491c2",
      "config": {}
    }
  ]
}
